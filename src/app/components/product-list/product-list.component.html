<div class="pl-page">
  <!-- ── Header ── -->
  <div class="pl-header">
    <div class="pl-header__text">
      <h1 class="pl-title">Product Catalog</h1>
      <p class="pl-subtitle">Browse all available products</p>
    </div>
    <div class="pl-header__controls">
      <!-- Search -->
      <div class="pl-search">
        <svg class="pl-search__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <input
          id="product-search"
          class="pl-search__input"
          type="text"
          placeholder="Search products…"
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchChange()"
        />
      </div>

      <!-- Category Filter -->
      <div class="pl-filter">
        <svg class="pl-filter__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
        </svg>
        <select
          id="category-filter"
          class="pl-filter__select"
          [(ngModel)]="selectedCategory"
          (ngModelChange)="onCategoryChange()"
        >
          <option *ngFor="let cat of categories" [value]="cat">
            {{ cat === 'all' ? 'All Categories' : cat }}
          </option>
        </select>
      </div>
    </div>
  </div>

  <!-- ── Stats bar ── -->
  <div class="pl-stats" *ngIf="!loading">
    <span class="pl-stats__count">
      {{ totalCount }} product{{ totalCount !== 1 ? 's' : '' }} found
    </span>
    <span class="pl-stats__page" *ngIf="totalPages > 1">
      Page {{ page }} of {{ totalPages }}
    </span>
  </div>

  <!-- ── Loading ── -->
  <div class="pl-loading" *ngIf="loading">
    <div class="pl-spinner"></div>
    <p>Loading products…</p>
  </div>

  <!-- ── Grid ── -->
  <div class="pl-grid" *ngIf="!loading">
    <a
      *ngFor="let product of pagedProducts"
      [routerLink]="['/products', product.id]"
      class="pl-card"
      id="product-card-{{ product.id }}"
    >
      <!-- Image -->
      <div class="pl-card__img-wrap">
        <img
          *ngIf="product.image"
          [src]="product.image"
          [alt]="product.productName"
          class="pl-card__img"
        />
        <div *ngIf="!product.image" class="pl-card__no-img">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="3" y="3" width="18" height="18" rx="2"/>
            <circle cx="8.5" cy="8.5" r="1.5"/>
            <polyline points="21 15 16 10 5 21"/>
          </svg>
        </div>
        <span class="pl-card__badge">{{ product.category }}</span>
      </div>

      <!-- Body -->
      <div class="pl-card__body">
        <p class="pl-card__sub">{{ product.subcategory }}</p>
        <h2 class="pl-card__name">{{ product.productName }}</h2>
        <div class="pl-card__footer">
          <span class="pl-card__price">\${{ product.listPrice | number:'1.2-2' }}</span>
          <span class="pl-card__arrow">→</span>
        </div>
      </div>
    </a>

    <!-- Empty state -->
    <div class="pl-empty" *ngIf="filteredProducts?.length === 0">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      <p>No products found</p>
    </div>
  </div>

  <!-- ── Pagination ── -->
  <div class="pl-pagination" *ngIf="!loading && totalPages > 1">
    <button
      class="pl-pagination__btn"
      id="btn-prev-page"
      (click)="prevPage()"
      [disabled]="page === 1"
    >← Prev</button>

    <span class="pl-pagination__info">{{ page }} / {{ totalPages }}</span>

    <button
      class="pl-pagination__btn"
      id="btn-next-page"
      (click)="nextPage()"
      [disabled]="page === totalPages"
    >Next →</button>
  </div>
</div>
